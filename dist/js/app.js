var myApp=angular.module("myApp",[]);myApp.controller("appController",["$scope",function(e){function n(){r()}function r(){var n=!1,r=!1,o=!1,c=function(){return n!==!1&&r!==!1&&o!==!1},a=function(){$.ajax({url:"https://api.fieldbook.com/v1/57efcbd80cfca603001a8a2d/productos",headers:{Accept:"application/json"},success:function(r){e.$apply(function(){t=r,n=!0,e.loadComplete=c()})},error:function(e){console.log("error",e)}})},s=function(){$.ajax({url:"https://api.fieldbook.com/v1/57efcbd80cfca603001a8a2d/clientes",headers:{Accept:"application/json"},success:function(n){e.$apply(function(){i=n,r=!0,e.loadComplete=c()})},error:function(e){console.log("error",e)}})},l=function(){$.ajax({url:"https://api.fieldbook.com/v1/57efcbd80cfca603001a8a2d/horarios",headers:{Accept:"application/json"},success:function(n){e.$apply(function(){u=n,o=!0,e.loadComplete=c()})},error:function(e){console.log("error",e)}})};a(),s(),l()}function o(e){var n,r=function(){return 0===u.getDay()?"Domingo":1===u.getDay()?"Lunes":2===u.getDay()?"Martes":3===u.getDay()?"Miercoles":4===u.getDay()?"Jueves":5===u.getDay()?"Viernes":6===u.getDay()?"Sabado":void 0},o=function(e,n,r,o){var t=function(){if(c===e){if(a>=n)return!0}else{if(c!==r)return!0;if(a<o)return!0}};if(null!=e&&null!=r){if(r===e)return!0;if(r<e){if((c>=e||c<=r)&&t())return!0}else if(c>=e&&c<=r&&t())return!0}return!1},t=function(e,n,r){if(void 0==n)return e;var o,t,i,u;return open1hour=Number(e.split(":")[0]),open2hour=Number(n.split(":")[0]),open1hour>open2hour?(i=open1hour,o=e,u=open2hour,t=n):(i=open2hour,o=n,u=open1hour,t=e),r<u?t:r<i?o:r>i?t:void 0},i=!1,u=new Date,c=u.getHours(),a=u.getMinutes();for(var s in e.hours)if(r()===e.hours[s].dia){if(void 0!=e.hours[s].abre&&void 0!=e.hours[s].cierra){var l=Number(e.hours[s].abre.split(":")[0]),p=Number(e.hours[s].abre.split(":")[1]),h=Number(e.hours[s].cierra.split(":")[0]),f=Number(e.hours[s].cierra.split(":")[1]);i=o(l,p,h,f)}void 0!=e.hours[s].vuelveabrir&&void 0!=e.hours[s].vuelvecerrar&&(l=Number(e.hours[s].vuelveabrir.split(":")[0]),p=Number(e.hours[s].vuelveabrir.split(":")[1]),h=Number(e.hours[s].vuelvecerrar.split(":")[0]),f=Number(e.hours[s].vuelvecerrar.split(":")[1]),i||(i=o(l,p,h,f))),n=t(e.hours[s].abre,e.hours[s].vuelveabrir,c)}e.openData={isOpen:i,openTime:n}}e.isMobile=window.innerWidth<=800,e.isSearchBoxFocused,e.clientsShown,e.loadComplete=!1,e.noResults,e.search=function(n){var r=function(e){var n=e.toLowerCase(),n=_.deburr(n);return n},c=function(e){var n=e.split(" "),r=[["lomo","lomito"],["whiskey","whiski","wisky","whisky","wiskey","wiski"],["sandwich","sanguche","sanguich"],["cerveza","birra","cervesa"]],o="";return _.each(n,function(e){_.each(r,function(n){var r=!1;_.each(n,function(t){e===t&&(r=!0,_.each(n,function(e){o+=" "+e}))})})}),o},a=function(e){var n=function(e){return"s"===e.slice(-1)&&(e=e.slice(0,-1)),e};e=r(e);var o=e.split(" "),t=["de","la","que","el","en","y","a","los","del","las","con"],i=[];return _.each(o,function(e){_.indexOf(t,e)<0&&(e=n(e),i.push(e))}),i},s=function(e){var n=function(e,n){var o=0,t=r(e),i=a(t).length;return _.each(n,function(e){var n=new RegExp("\\b"+e,"i");t.search(n)!=-1&&o++}),o===i},s=function(e,n){var o=!0,t=r(e.producto);return void 0!=c(t)&&(t+=" "+c(t)),_.each(n,function(e){var n=new RegExp("\\b"+e,"i");t.search(n)==-1&&(o=!1)}),o},l=function(e,n,r,o){var t=_.find(o,["id",n.cliente[0].id]),i=[];return _.each(r,function(n){n.cliente[0].cliente===e&&i.push(n)}),{client:t,matchedProducts:[],hours:i}},p=function(e){var n=_.groupBy(e,function(e){return e.openData.isOpen===!0?"open":void 0!=e.openData.openTime?"openLater":"closed"});return n.openLater=_.sortBy(n.openLater,[function(e){return e.openData.openTime}]),n},h=[],f=[];_.each(t,function(r){var t=r.cliente[0].cliente,c=s(r,e);if(void 0!=t){var a=n(t,e);(c||a)&&(t in f||(f[t]=l(t,r,u,i),o(f[t])),f[t].matchedProducts.push(r))}});for(client in f)f[client].matchedProducts=_.sortBy(f[client].matchedProducts,[function(e){return e.producto}]),h.push(f[client]);return p(h)};ga("send","pageview","search?searchText="+n),document.getElementById("searchterm").blur(),e.noResults=!0,e.clientsShown=[];var l=a(n);e.clientsShown=s(l),(void 0!=e.clientsShown.open&&e.clientsShown.open.length>0||void 0!=e.clientsShown.openLater&&e.clientsShown.openLater.length>0||void 0!=e.clientsShown.closed&&e.clientsShown.closed.length>0)&&(e.noResults=!1)},e.logoPressed=function(){document.getElementById("searchterm").focus()};var t,i,u;n()}]);